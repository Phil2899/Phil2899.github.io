<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Visual Query Editor</title>

    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <script src="https://unpkg.com/blockly/php_compressed.js"></script>



</head>
<body>
    <h1>Visual Query Editor</h1>

    
    <div class="dropdown-bar">
        Language : 
        

        <p>
            <select id="languageDropdown" style="font-size : 16px" onchange="myUpdateFunction();">
                <option value="JavaScript"> JavaScript</option>
                <option value="PHP">PHP</option>
            </select>
        </p>

    </div>

    <div id="blocklyDiv" style="display: inline-block; height: 480px; width: 58%;"></div>
    <div id="codeDiv" style="display : inline-block; height: 480px; width:38%; padding:8px ;overflow: scroll">

        <pre id="codeBlock_js" class="prettyprint_js"></pre>

    </div>
    
    
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
        <category name="Logic" colour="%{BKY_LOGIC_HUE}">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_negate"></block>
            <block type="logic_null"></block>
            <block type="logic_ternary"></block>
        </category>
        <category name="Loops" colour="%{BKY_LOOPS_HUE}">
            <block type="controls_repeat_ext"></block>
        </category>
        <category name="Math" colour="%{BKY_MATH_HUE}">
            <block type="math_number"></block>
            <block type="math_arithmetic"></block>
        </category>   
        <category name="Text" colour="%{BKY_TEXTS_HUE}">
            <block type="text"></block>
            <block type="text_print"></block>
        </category>
        <sep></sep>
        <category name="Variables" custom="VARIABLE" colour="%{BKY_VARIABLES_HUE}">
        </category>
        <category name="Functions" colour="%{BKY_PROCEDURES_HUE}">
            <block type="procedures_defnoreturn"></block>
            <block type="procedures_defreturn"></block>
            <block type="procedures_mutatorcontainer"></block>
        </category>
    </xml>

    <xml xmlns="https://developers.google.com/blockly/xml" id="startBlocks" style="display: none">
        <block type="controls_if" inline="false" x="20" y="20">
        <mutation else="1"></mutation>
        <value name="IF0">
            <block type="logic_compare" inline="true">
            <field name="OP">EQ</field>
            <value name="A">
                <block type="math_arithmetic" inline="true">
                <field name="OP">MULTIPLY</field>
                <value name="A">
                    <block type="math_number">
                    <field name="NUM">6</field>
                    </block>
                </value>
                <value name="B">
                    <block type="math_number">
                    <field name="NUM">7</field>
                    </block>
                </value>
                </block>
            </value>
            <value name="B">
                <block type="math_number">
                <field name="NUM">42</field>
                </block>
            </value>
            </block>
        </value>
        <statement name="DO0">
            <block type="text_print" inline="false">
            <value name="TEXT">
                <block type="text">
                <field name="TEXT">Don't panic</field>
                </block>
            </value>
            </block>
        </statement>
        <statement name="ELSE">
            <block type="text_print" inline="false">
            <value name="TEXT">
                <block type="text">
                <field name="TEXT">Panic</field>
                </block>
            </value>
            </block>
        </statement>
        </block>
    </xml>   


  
    

    <script>

        var workspace = Blockly.inject('blocklyDiv',
          {toolbox: document.getElementById('toolbox')});

        Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),workspace);

        
        
        
        function myUpdateFunction(event){
            
            var languageDropdown = document.getElementById('languageDropdown');
            
            var language = languageDropdown.value;
            
            var codeDiv = document.getElementById('codeDiv');
            var codeHolder = document.createElement('pre');
            codeHolder .className = 'prettyprint_js';
            var code = document.createTextNode(Blockly[language].workspaceToCode(workspace));
            codeHolder.appendChild(code);
            codeDiv.replaceChild(codeHolder, codeDiv.lastElementChild);
            
            prettyPrint();
        }
        workspace.addChangeListener(myUpdateFunction);
        

    </script>

</body>
</html>